

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Supporting Logging &mdash; Paramore 7.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Implementing a Distributed Task Queue" href="ImplementingDistributedTaskQueue.html" />
    <link rel="prev" title="Basic Configuration" href="BasicConfiguration.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Paramore
          

          
          </a>

          
            
            
              <div class="version">
                7.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ImplementingAHandler.html">How to Implement a Request Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="DispatchingARequest.html">Dispatching Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAPipeline.html">Building a Pipeline of Request Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAPipeline.html#the-pipes-and-filters-architectural-style">The Pipes and Filters Architectural Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAPipeline.html#the-russian-doll-model">The Russian Doll Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAPipeline.html#implementing-a-pipeline">Implementing a Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAPipeline.html#using-a-manual-approach">Using a Manual Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="UsingTheContextBag.html">Passing information between Handlers in the Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="PolicyRetryAndCircuitBreaker.html">Supporting Retry and Circuit Breaker</a></li>
<li class="toctree-l1"><a class="reference internal" href="PolicyRetryAndCircuitBreaker.html#using-brighter-s-usepolicy-attribute">Using Brighter’s UsePolicy Attribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="PolicyRetryAndCircuitBreaker.html#timeout">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="PolicyFallback.html">Failure and Fallback</a></li>
<li class="toctree-l1"><a class="reference internal" href="EventSourcing.html">Event Sourcing</a></li>
<li class="toctree-l1"><a class="reference internal" href="EventSourcing.html#command-or-event-sourcing">Command or Event Sourcing</a></li>
<li class="toctree-l1"><a class="reference internal" href="EventSourcing.html#command-sourcing-in-brighter">Command Sourcing in Brighter</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicConfiguration.html">Basic Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicConfiguration.html#what-you-need-to-provide">What you need to provide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Supporting Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#logger">Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html">Implementing a Distributed Task Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html#brighter-s-task-queue-architecture">Brighter’s Task Queue Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html#do-i-have-to-use-a-broker-what-about-msmq">Do I have to use a Broker, what about MSMQ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html#what-happens-when-the-consumer-receives-the-message">What happens when the consumer receives the message?</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html#what-does-this-look-like-in-code">What does this look like in code</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html#the-dispatcher">The Dispatcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingDistributedTaskQueue.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="DistributedTaskQueueConfiguration.html">Distributed Task Queue Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="DistributedTaskQueueConfiguration.html#configuring-the-dispatcher-in-code">Configuring the Dispatcher in Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="RabbitMQConfiguration.html">RabbitMQ Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="RunningUnderAWSSQSInfrastructure.html">Running Brighter under AWS SQS Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="AWSSQSConfiguration.html">AWS SQS Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="AsyncDispatchARequest.html">Dispatching Requests Asynchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplementingAsyncHandler.html">How to Implement an Asynchronous Request Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAnAsyncPipeline.html">Building a Pipeline of Async Request Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAnAsyncPipeline.html#implementing-a-pipeline">Implementing a Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="FeatureSwitches.html">Feature Switches</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frquently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Paramore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Supporting Logging</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Logging.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="supporting-logging">
<h1>Supporting Logging<a class="headerlink" href="#supporting-logging" title="Permalink to this headline">¶</a></h1>
<p>// Has the logger changed? is there a default .net one??</p>
<div class="section" id="logger">
<h2>Logger<a class="headerlink" href="#logger" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="https://github.com/damianh/LibLog">LibLog</a> so that we do not
have to depend on a given logging library. You will want to add a
logger, supported by LibLog to your project (as per the instructions for
LibLog) if you want to see log output from Brighter.</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>LibLog can either keep the ILog used by the client library private to
the library, or allow the client library to expose it. Brighter chooses
to expose the ILog implementation that we receive from ILog.</p>
<p>Why?</p>
<p>When testing you may want to avoid a dependency on the static logger
that LibLog wraps your current logging framework with, as static
variables can make tests behave erratially when run in parallel, or as
part of a suite. For this reason we tend to add a constructor that
explicitly takes an instance of Brighter’s ILog to allow you to provide
an <a class="reference external" href="https://en.wikipedia.org/wiki/Test_double">Test Double</a> of that
ILog implementation.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="na">[Subject(typeof(PipelineBuilder&lt;&gt;))]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">When_Building_A_Handler_For_A_Command</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">PipelineBuilder</span><span class="p">&lt;</span><span class="n">MyCommand</span><span class="p">&gt;</span> <span class="n">s_chain_Builder</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">IHandleRequests</span><span class="p">&lt;</span><span class="n">MyCommand</span><span class="p">&gt;</span> <span class="n">s_chain_Of_Responsibility</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">RequestContext</span> <span class="n">s_request_context</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">Establish</span> <span class="n">_context</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">A</span><span class="p">.</span><span class="n">Fake</span><span class="p">&lt;</span><span class="n">ILog</span><span class="p">&gt;();</span>
        <span class="kt">var</span> <span class="n">registry</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SubscriberRegistry</span><span class="p">();</span>
        <span class="n">registry</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">MyCommand</span><span class="p">,</span> <span class="n">MyCommandHandler</span><span class="p">&gt;();</span>
        <span class="kt">var</span> <span class="n">handlerFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TestHandlerFactory</span><span class="p">&lt;</span><span class="n">MyCommand</span><span class="p">,</span> <span class="n">MyCommandHandler</span><span class="p">&gt;(()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">MyCommandHandler</span><span class="p">(</span><span class="n">logger</span><span class="p">));</span>
        <span class="n">s_request_context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RequestContext</span><span class="p">();</span>

        <span class="n">s_chain_Builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PipelineBuilder</span><span class="p">&lt;</span><span class="n">MyCommand</span><span class="p">&gt;(</span><span class="n">registry</span><span class="p">,</span> <span class="n">handlerFactory</span><span class="p">,</span> <span class="n">logger</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">private</span> <span class="n">Because</span> <span class="n">_of</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">s_chain_Of_Responsibility</span> <span class="p">=</span> <span class="n">s_chain_Builder</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="n">s_request_context</span><span class="p">).</span><span class="n">First</span><span class="p">();</span>

    <span class="k">private</span> <span class="n">It</span> <span class="n">_should_have_set_the_context_on_the_handler</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">s_chain_Of_Responsibility</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">ShouldNotBeNull</span><span class="p">();</span>
    <span class="k">private</span> <span class="n">It</span> <span class="n">_should_use_the_context_that_we_passed_in</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">s_chain_Of_Responsibility</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">ShouldBeTheSameAs</span><span class="p">(</span><span class="n">s_request_context</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, outside of testing, you rarely need to provide the instance of
ILog. This is because in the base class <strong>RequestHandler&lt;T&gt;</strong> the
default constructor simply grabs the current logger from LibLog.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">///</span>
<span class="c1">/// Initializes a new instance of the  class.</span>
<span class="c1">///</span>
<span class="k">protected</span> <span class="nf">RequestHandler</span><span class="p">()</span>
<span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">LogProvider</span><span class="p">.</span><span class="n">GetCurrentClassLogger</span><span class="p">())</span>
<span class="p">{}</span>
</pre></div>
</div>
<p>The only time you might want to change this, is if you intend to call a
more derived constructor in your own code, that contains the ILog used
by testing. In this case, you can still keep ILog out of your code, by
providing the call to LibLog yourself
(<strong>LogProvider.GetCurrentClassLogger()</strong>)</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nf">MailTaskReminderHandler</span><span class="p">(</span><span class="n">IAmAMailGateway</span> <span class="n">mailGateway</span><span class="p">,</span> <span class="n">IAmACommandProcessor</span> <span class="n">commandProcessor</span><span class="p">)</span>
    <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">mailGateway</span><span class="p">,</span> <span class="n">commandProcessor</span><span class="p">,</span> <span class="n">LogProvider</span><span class="p">.</span><span class="n">GetCurrentClassLogger</span><span class="p">())</span>
<span class="p">{}</span>

<span class="k">public</span> <span class="nf">MailTaskReminderHandler</span><span class="p">(</span><span class="n">IAmAMailGateway</span> <span class="n">mailGateway</span><span class="p">,</span> <span class="n">IAmACommandProcessor</span> <span class="n">commandProcessor</span><span class="p">,</span> <span class="n">ILog</span> <span class="n">logger</span><span class="p">)</span>
    <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">_mailGateway</span> <span class="p">=</span> <span class="n">mailGateway</span><span class="p">;</span>
    <span class="n">_commandProcessor</span> <span class="p">=</span> <span class="n">commandProcessor</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ImplementingDistributedTaskQueue.html" class="btn btn-neutral float-right" title="Implementing a Distributed Task Queue" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="BasicConfiguration.html" class="btn btn-neutral" title="Basic Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Ian Cooper

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>